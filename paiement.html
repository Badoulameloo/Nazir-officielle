<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAIEMENT | NAZIR</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Styles spécifiques pour le récapitulatif de paiement */
        .paiement-container { max-width: 600px; margin: 100px auto; padding: 20px; color: white; }
        .recap-produit { display: flex; gap: 20px; background: #111; padding: 20px; border-radius: 8px; margin-bottom: 30px; align-items: center; }
        .recap-produit img { width: 100px; height: 130px; object-fit: cover; border-radius: 4px; }
        .recap-infos h2 { font-size: 1.2rem; margin-bottom: 10px; }
        .price-tag { color: #888; font-weight: bold; }
        
        /* Style des boutons radio de taille (identique à la page détails) */
        .size-selection-paiement { margin: 20px 0; padding: 15px; border-top: 1px solid #333; }
        .size-options { display: flex; gap: 10px; margin-top: 10px; }
        .size-options input { display: none; }
        .size-options label { border: 1px solid white; padding: 10px 20px; cursor: pointer; transition: 0.3s; }
        .size-options input:checked + label { background: white; color: black; }
        
        .total-box { display: flex; justify-content: space-between; font-size: 1.5rem; font-weight: bold; margin: 30px 0; border-top: 2px solid white; padding-top: 20px; }
        .btn-valider { width: 100%; background: white; color: black; border: none; padding: 18px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
    </style>
</head>
<body class="dark-theme">

    <nav class="navbar">
        <div class="nav-left"><a href="index.html">HOME</a></div>
        <div class="nav-logo"><img src="img/img.logo.jpeg.png.png" alt="NAZIR"></div>
        <div class="nav-right"><a href="panier.html">PANIER</a></div>
    </nav>

    <main class="paiement-container">
        <h1>FINALISER MA COMMANDE</h1>

        <div class="recap-produit">
            <img src="" id="recap-img" alt="Produit">
            <div class="recap-infos">
                <h2 id="recap-nom">Chargement...</h2>
                <p class="price-tag" id="recap-prix">0 CFA</p>
                <p id="recap-taille-fixe" style="margin-top: 10px; font-weight: bold; display: none;"></p>
            </div>
        </div>

        <div id="zone-choix-taille" class="size-selection-paiement" style="display: none;">
            <p>SÉLECTIONNEZ VOTRE TAILLE POUR CE PRODUIT :</p>
            <div class="size-options">
                <input type="radio" name="sizePaiement" value="S" id="ps"><label for="ps">S</label>
                <input type="radio" name="sizePaiement" value="M" id="pm"><label for="pm">M</label>
                <input type="radio" name="sizePaiement" value="L" id="pl"><label for="pl">L</label>
                <input type="radio" name="sizePaiement" value="XL" id="pxl"><label for="pxl">XL</label>
            </div>
        </div>

        <div class="total-box">
            <span>TOTAL</span>
            <span id="recap-total">0 CFA</span>
        </div>

        <button onclick="envoyerCommande()" class="btn-valider">CONFIRMER ET PAYER</button>
    </main>

    <script>
        window.onload = function() {
            // 1. Récupération des données du LocalStorage
            const nom = localStorage.getItem('produitNom');
            const prix = localStorage.getItem('produitPrix');
            const image = localStorage.getItem('produitImage');
            const tailleDejaChoisie = localStorage.getItem('produitTaille');

            // 2. Injection des données de base
            if (nom) {
                document.getElementById('recap-nom').innerText = nom;
                document.getElementById('recap-prix').innerText = prix;
                document.getElementById('recap-total').innerText = prix;
                document.getElementById('recap-img').src = image;
            }

            // 3. LOGIQUE DE LA TAILLE
            const zoneChoix = document.getElementById('zone-choix-taille');
            const texteFixe = document.getElementById('recap-taille-fixe');

            // Si la taille est vide ou undefined (provenance "Acheter maintenant")
            if (!tailleDejaChoisie || tailleDejaChoisie === "" || tailleDejaChoisie === "undefined") {
                zoneChoix.style.display = "block"; // On montre le choix
                texteFixe.style.display = "none";
            } else {
                // Provenance "Détails" (Taille déjà choisie)
                zoneChoix.style.display = "none";
                texteFixe.innerText = "TAILLE SÉLECTIONNÉE : " + tailleDejaChoisie;
                texteFixe.style.display = "block";
            }
        };

        function envoyerCommande() {
            let tailleFinale = localStorage.getItem('produitTaille');
            const zoneChoix = document.getElementById('zone-choix-taille');

            // Si l'utilisateur devait choisir la taille sur cette page
            if (zoneChoix.style.display === "block") {
                const selection = document.querySelector('input[name="sizePaiement"]:checked');
                if (!selection) {
                    alert("Oups ! N'oubliez pas de sélectionner votre taille.");
                    return;
                }
                tailleFinale = selection.value;
            }

            const nom = localStorage.getItem('produitNom');
            const prix = localStorage.getItem('produitPrix');

            // Construction du message WhatsApp
            const message = `Bonjour NAZIR, je souhaite commander :
- Produit : ${nom}
- Taille : ${tailleFinale}
- Prix : ${prix}`;

            const phone = "221XXXXXXXXX"; // REMPLACE PAR TON NUMÉRO
            window.location.href = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
        }
    </script>
</body>
</html>